<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--=============== FAVICON ===============-->
    <link rel="shortcut icon" href="assets/img/favicon.png" type="image/x-icon">

    <!--=============== BOXICONS ===============-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">

    <!--=============== SWIPER CSS ===============--> 
    <link rel="stylesheet" href="assets/css/swiper-bundle.min.css">

    <!--=============== CSS ===============-->
    <link rel="stylesheet" href="assets/css/styles.css">

    <title id="product-title"></title>
    <style>
        .toast {
            visibility: hidden;
            max-width: 300px;
            margin: auto;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            position: fixed;
            z-index: 1;
            top: 20px;
            right: 20px;
            font-size: 17px;
            padding: 10px;
        }

        .toast.success {
            background-color: #4CAF50;
        }

        .toast.error {
            background-color: #f44336;
        }

        .toast.show {
            visibility: visible;
            -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @-webkit-keyframes fadein {
            from {top: 0; opacity: 0;} 
            to {top: 20px; opacity: 1;}
        }

        @keyframes fadein {
            from {top: 0; opacity: 0;}
            to {top: 20px; opacity: 1;}
        }

        @-webkit-keyframes fadeout {
            from {top: 20px; opacity: 1;} 
            to {top: 0; opacity: 0;}
        }

        @keyframes fadeout {
            from {top: 20px; opacity: 1;}
            to {top: 0; opacity: 0;}
        }
    </style>
</head>
<body>
    <!-- Modal structure -->
    <div id="priceRequestModal" class="modal">
      <div class="modal-content">
          <span class="close">&times;</span>
          <form id="priceRequestForm">
              <div class="form-group">
                  <label for="firstName">First Name <span>*</span></label>
                  <input type="text" id="firstName" name="firstName" placeholder="Your First Name" required>
              </div>
              <div class="form-group">
                  <label for="lastName">Last Name <span>*</span></label>
                  <input type="text" id="lastName" name="lastName" placeholder="Your Last Name" required>
              </div>
              <div class="form-group">
                  <label for="email">E-mail <span>*</span></label>
                  <input type="email" id="email" name="email" placeholder="abc@abc.com" required>
              </div>
              <div class="form-group">
                  <label for="contactNumber">Contact Number <span>*</span></label>
                  <input type="tel" id="contactNumber" name="contactNumber" placeholder="(xxx) xxx-xxxx" required>
              </div>
              <div class="form-group">
                  <label for="message">Message</label>
                  <textarea id="message" name="message" placeholder="Message"></textarea>
              </div>
              <button type="submit" class="modal-button">Submit</button>
          </form>
      </div>
    </div>

    <!-- Toast notification -->
    <div id="toast" class="toast"></div>

    <!--==================== HEADER ====================-->
    <header class="header" id="header">
        <nav class="nav container">
            <a href="index.html" class="nav__logo">
                <i class='bx bxs-watch nav__logo-icon'></i> Luxury Time PCSZ
            </a>

            <div class="nav__menu" id="nav-menu">
                <ul class="nav__list">
                    <li class="nav__item">
                        <a href="#home" class="nav__link active-link">Home</a>
                    </li>
                    <li class="nav__item dropdown">
                        <a href="#" class="nav__link dropdown__link">Catalog <i class='bx bx-chevron-down'></i></a>
                        <ul class="dropdown__menu">
                            <li><a href="/catalog.html?products=rolex.json" class="dropdown__item">Rolex</a></li>
                            <li><a href="/catalog.html?products=piguet.json" class="dropdown__item">Audemars Piguet</a></li>
                            <li><a href="/catalog.html?products=patek.json" class="dropdown__item">Patek Philippe</a></li>
                            <li><a href="/catalog.html?products=cartier.json" class="dropdown__item">Cartier</a></li>
                        </ul>
                    </li>
                    <li class="nav__item">
                        <a href="http://luxurytimepczs.printify.me" class="nav__link">Shop</a>
                    </li>
                </ul>
        
                <div class="nav__close" id="nav-close">
                    <i class='bx bx-x'></i>
                </div>
            </div>

            <div class="nav__btns">
                <i class='bx bx-moon change-theme' id="theme-button"></i>
                <div class="nav__toggle" id="nav-toggle">
                    <i class='bx bx-grid-alt'></i>
                </div>
            </div>
        </nav>
    </header>

    <!--==================== MAIN ====================-->
    <main class="main">
        <!--==================== PRODUCT ====================-->
        <section class="product section container">
            <div class="product__container grid">
                <div class="product__img-wrapper">
                    <img id="product-img" src="" alt="Product Image" class="product__img">
                </div>
                
                <div class="product__details">
                    <h1 id="product-name" class="product__title"></h1>
                    <span id="product-viewers" class="product__price">üëÅÔ∏è <strong>23 people</strong> are viewing this right now</span>
                    <p id="product-description" class="product__description"></p>
                    <ul id="product-features" class="product__features"></ul>

                    <button class="button price-on-request-button">PRICE ON REQUEST</button>
                </div>
            </div>
        </section>
    </main>

    <!--==================== FOOTER ====================-->
    <footer class="footer section">
        <div class="footer__container container grid">
            <div class="footer__content">
                <h3 class="footer__title">Our information</h3>
                <ul class="footer__list">
                    <li>954-696-9420</li>
                    <li>luxurytimepcsz@gmail.com</li>
                </ul>
            </div>

            <div class="footer__content">
                <h3 class="footer__title">About Us</h3>
                <ul class="footer__links">
                    <li><a href="#" class="footer__link">Support Center</a></li>
                    <li><a href="#" class="footer__link">Customer Support</a></li>
                    <li><a href="#" class="footer__link">About Us</a></li>
                    <li><a href="#" class="footer__link">Copy Right</a></li>
                </ul>
            </div>

            <div class="footer__content">
                <h3 class="footer__title">Catalog</h3>
                <ul class="footer__links">
                    <li><a href="rolex.html" class="footer__link">Rolex</a></li>
                    <li><a href="#" class="footer__link">Omega</a></li>
                    <li><a href="#" class="footer__link">Tag Heuer</a></li>
                    <li><a href="#" class="footer__link">Patek Philippe</a></li>
                </ul>
            </div>

            <div class="footer__content">
                <h3 class="footer__title">Social</h3>
                <ul class="footer__social">
                    <a href="https://www.facebook.com/" target="_blank" class="footer__social-link">
                        <i class='bx bxl-facebook'></i>
                    </a>
                    <a href="https://github.com/" target="_blank" class="footer__social-link">
                        <i class='bx bxl-github'></i>
                    </a>
                    <a href="https://www.linkedin.com/" target="_blank" class="footer__social-link">
                        <i class='bx bxl-linkedin'></i>
                    </a>
                </ul>
            </div>
        </div>

        <span class="footer__copy">&#169; Volare Solutions LLC. All rights reserved</span>
    </footer>

    <!--=============== SCROLL UP ===============-->
    <a href="#" class="scrollup" id="scroll-up">
        <i class='bx bx-up-arrow-alt scrollup__icon'></i>
    </a>

    <!--=============== SWIPER JS ===============-->
    <script src="assets/js/swiper-bundle.min.js"></script>

    <!--=============== MAIN JS ===============-->
    <script src="assets/js/main.js"></script>

    <!--=============== PRODUCT JS ===============-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pica/5.0.0/pica.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('index');
            const jsonFileName = urlParams.get('json') || 'products.json'; // Default to 'products.json' if no param is provided
    
            if (productId !== null) {
                fetch(jsonFileName)
                    .then(response => response.json())
                    .then(products => {
                        const product = products[productId];
                        if (product) {
                            document.getElementById('product-title').textContent = `${product.title} - Luxury Time PCSZ`;
                            processImage(product.imageUrl).then(processedImageUrl => {
                                document.getElementById('product-img').src = processedImageUrl;
                            });
                            document.getElementById('product-name').textContent = product.title;
                            document.getElementById('product-description').textContent = product.description;
                            
                            const featuresList = document.getElementById('product-features');
                            featuresList.innerHTML = '';
                            product.features.forEach(feature => {
                                const li = document.createElement('li');
                                li.textContent = feature;
                                featuresList.appendChild(li);
                            });
                        } else {
                            console.error('Product not found');
                        }
                    })
                    .catch(error => console.error('Error loading product:', error));
            } else {
                console.error('No product ID found in URL');
            }
        });
    
        function processImage(imageUrl) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = "Anonymous"; // This enables cross-origin image processing
                img.src = imageUrl;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
    
                    const targetCanvas = document.createElement('canvas');
                    const targetCtx = targetCanvas.getContext('2d');
                    targetCanvas.width = canvas.width * 2; // Increase resolution
                    targetCanvas.height = canvas.height * 2;
    
                    pica().resize(canvas, targetCanvas, {
                        quality: 3,
                        unsharpAmount: 80,
                        unsharpRadius: 0.6,
                        unsharpThreshold: 2
                    }).then(result => {
                        return pica().toBlob(result, 'image/png', 0.90);
                    }).then(blob => {
                        const newImg = document.createElement('img');
                        newImg.src = URL.createObjectURL(blob);
                        newImg.onload = () => {
                            // Use this processed image
                            resolve(newImg.src);
                        };
                    }).catch(err => reject(err));
                };
                img.onerror = reject;
            });
        }

        function showToast(message, type) {
            const toast = document.getElementById('toast');
            toast.className = `toast ${type} show`;
            toast.innerHTML = message;
            setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
        }

        function clearForm() {
            document.getElementById('priceRequestForm').reset();
        }

        document.getElementById('priceRequestForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());

            fetch('/api/submit-form', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                clearForm();
                showToast('Form submitted successfully!', 'success');
                console.log('Success:', data);
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('There was a problem with the form submission.', 'error');
            });
        });
    </script>    
</body>
</html>
